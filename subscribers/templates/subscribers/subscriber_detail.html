{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Subscriber Details" %} - {{ subscriber.full_name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-6">
        <a href="{% url 'subscribers:list' %}" class="text-blue-500 hover:text-blue-700 flex items-center">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            {% trans "Back to Subscribers List" %}
        </a>
    </div>

    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
        <div class="p-4 mb-4 {% if message.tags == 'success' %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %} rounded">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="bg-white shadow-lg rounded-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <h1 class="text-2xl font-bold text-gray-800">{% trans "Subscriber Details" %}</h1>
        </div>
        
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Standard Information -->
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">{% trans "Standard Information" %}</h2>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Full Name" %}</label>
                        <p class="mt-1 text-gray-900">{{ subscriber.full_name }}</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Email" %}</label>
                        <p class="mt-1 text-gray-900">{{ subscriber.email }}</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Phone Number" %}</label>
                        <p class="mt-1 text-gray-900">{{ subscriber.phone_number }}</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Business Name" %}</label>
                        <p class="mt-1 text-gray-900">{{ subscriber.business_name }}</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Residence Country" %}</label>
                        <p class="mt-1 text-gray-900">{{ subscriber.residence_country }}</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Registration Date" %}</label>
                        <p class="mt-1 text-gray-900">{{ subscriber.registration_date|date:"F j, Y H:i" }}</p>
                    </div>
                </div>

                <!-- Additional Critical Information -->
                <div class="space-y-4">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">{% trans "Additional Information" %}</h2>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Store Link" %}</label>
                        {% if subscriber.store_link %}
                        <a href="{{ subscriber.store_link }}" target="_blank" class="mt-1 text-blue-600 hover:text-blue-800 break-all">
                            {{ subscriber.store_link }}
                        </a>
                        {% else %}
                        <p class="mt-1 text-gray-500">{% trans "No store link provided" %}</p>
                        {% endif %}
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-600">{% trans "Services" %}</label>
                        {% if subscriber.services %}
                        <ul class="mt-1 list-disc list-inside space-y-1">
                            {% for service in subscriber.services %}
                            <li class="text-gray-900">{{ service }}</li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="mt-1 text-gray-500">{% trans "No services added" %}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
            <button onclick="deleteSubscriber({{ subscriber.pk }})" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
                {% trans "Delete Subscriber" %}
            </button>
        </div>
    </div>
</div>

<script>
function deleteSubscriber(id) {
    if (confirm("{% trans 'Are you sure you want to delete this subscriber?' %}")) {
        fetch(`/subscribers/${id}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                window.location.href = "{% url 'subscribers:list' %}";
            } else {
                alert("{% trans 'Error deleting subscriber' %}");
            }
        });
    }
}
</script>
{% endblock %} 