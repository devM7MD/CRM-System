<!DOCTYPE html>
{% load static %}
{% load i18n %}
<html lang="{{ LANGUAGE_CODE }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "Atlas Fulfillment" %}{% endblock %}</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fef9e7',
                            100: '#fef3c7',
                            200: '#fde68a',
                            300: '#fcd34d',
                            400: '#fbbf24',
                            500: '#eab308',
                            600: '#ca8a04',
                            700: '#a16207',
                            800: '#854d0e',
                            900: '#713f12',
                        },
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-in': 'bounceIn 0.6s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
            overflow-x: hidden;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1e293b;
        }
        
        main {
            flex: 1;
        }
        
        /* Enhanced Sidebar */
        .sidebar {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed;
            height: calc(100vh - 64px);
            overflow-y: auto;
            scrollbar-width: thin;
            -ms-overflow-style: none;
            background: linear-gradient(180deg, #222d3f 0%, #101727 100%);
            top: 64px !important;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        
        
        /* ملف globals.css أو داخل styles */
::-webkit-scrollbar {
  width: 0px;              /* العرض */
  height: 8px;             /* لو كان فيه scroll أفقي */
}

::-webkit-scrollbar-track {
  background: #1f1f1f;     /* خلفية المسار */
}

::-webkit-scrollbar-thumb {
  background: #888;        /* لون الزر (thumb) */
  border-radius: 0px;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}

        
        /* Enhanced Main Content */
        .main-content {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: calc(100vh - 64px);
            background: transparent;
            padding: 0;
            margin-left: 0;
            width: 100%;
        }
        
        @media (min-width: 1024px) {
            .main-content {
                margin-left: 16rem; /* 256px = 16rem */
                width: calc(100% - 16rem);
            }
        }
        
        /* Loading Animation */
        .loading {
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 1023px) {
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 1rem;
            }
            
            .content-wrapper > div {
                max-width: 100%;
                padding: 0 1rem;
            }
        }
        
        /* Enhanced Header */
        .header-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            height: 64px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .page-container {
            padding-top: 64px;
        }
        
        /* Enhanced Cards */
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .card-header {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-bottom: 1px solid rgba(234, 179, 8, 0.2);
            padding: 1.5rem;
        }
        
        /* Enhanced Menu Items */
        .menu-item {
            border-radius: 12px;
            margin-bottom: 4px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #cbd5e1;
            position: relative;
            overflow: hidden;
        }
        
        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .menu-item:hover::before {
            left: 100%;
        }
        
        .menu-item:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            color: #ffffff;
            transform: translateX(4px);
        }
        
        .menu-item.active {
            background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
            color: #ffffff;
            box-shadow: 0 4px 12px rgba(234, 179, 8, 0.3);
            transform: translateX(4px);
        }
        
        .menu-item i {
            color: inherit;
            transition: transform 0.3s ease;
        }
        
        .menu-item:hover i {
            transform: scale(1.1);
        }
        
        /* Enhanced Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(234, 179, 8, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #ca8a04 0%, #a16207 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(234, 179, 8, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(100, 116, 139, 0.3);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(100, 116, 139, 0.4);
        }
        
        /* Enhanced Tables */
        .table-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        thead th {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #854d0e;
            font-weight: 600;
            padding: 1rem;
            border-bottom: 2px solid rgba(234, 179, 8, 0.2);
        }
        
        tbody tr {
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }
        
        tbody tr:hover {
            background: linear-gradient(135deg, #fef9e7 0%, #fef3c7 100%);
            transform: scale(1.01);
        }
        
        tbody td {
            padding: 1rem;
            vertical-align: middle;
        }
        
        /* Enhanced Status Badges */
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
        }
        
        .status-pending {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #854d0e;
        }
        
        .status-processing {
            background: linear-gradient(135deg, #dbeafe 0%, #93c5fd 100%);
            color: #1e40af;
        }
        
        .status-shipped {
            background: linear-gradient(135deg, #dcfce7 0%, #86efac 100%);
            color: #166534;
        }
        
        .status-delivered {
            background: linear-gradient(135deg, #bbf7d0 0%, #4ade80 100%);
            color: #14532d;
        }
        
        .status-cancelled {
            background: linear-gradient(135deg, #fecaca 0%, #f87171 100%);
            color: #991b1b;
        }
        
        /* Enhanced Form Elements */
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .form-input:focus {
            border-color: #eab308;
            box-shadow: 0 0 0 3px rgba(234, 179, 8, 0.1);
            outline: none;
        }
        
        /* Enhanced Dashboard Stats */
        .dashboard-stat {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border-left: 4px solid #eab308;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        
        .dashboard-stat:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
            color: white;
            font-size: 1.25rem;
        }
        
        /* Enhanced Search Bar */
        .search-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        /* Content Wrapper */
        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }
        
        .content-wrapper > div {
            width: 100%;
            max-width: 1200px;
        }
        
        /* Enhanced Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }
        
        .page-link {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(226, 232, 240, 0.8);
            color: #64748b;
            transition: all 0.3s ease;
        }
        
        .page-link:hover {
            background: #eab308;
            color: white;
            transform: translateY(-1px);
        }
        
        .page-link.active {
            background: #eab308;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(234, 179, 8, 0.3);
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(234, 179, 8, 0.3);
            border-radius: 50%;
            border-top-color: #eab308;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* RTL Support */
        [dir="rtl"] .sidebar {
            right: 0;
            left: auto;
        }
        
        [dir="rtl"] .main-content {
            margin-right: 16rem;
            margin-left: 0;
        }
        
        [dir="rtl"] .dashboard-stat {
            border-left: none;
            border-right: 4px solid #eab308;
        }
        
        [dir="rtl"] .ml-2, [dir="rtl"] .ml-3, [dir="rtl"] .ml-4 {
            margin-left: 0;
            margin-right: 0.5rem;
        }
        
        [dir="rtl"] .mr-2, [dir="rtl"] .mr-3, [dir="rtl"] .mr-4 {
            margin-right: 0;
            margin-left: 0.5rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .card {
                border-radius: 12px;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-100">
    <nav class="header-nav text-gray-900 shadow-sm py-2">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <button id="sidebar-toggle" class="mr-4 p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-yellow-500 lg:hidden transition-colors duration-200">
                        <i class="fas fa-bars text-gray-600"></i>
                    </button>
                    <a href="{% url 'dashboard:index' %}" class="flex items-center logo-container">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg flex items-center justify-center mr-3 shadow-lg">
                                <i class="fas fa-shipping-fast text-white text-xl"></i>
                            </div>
                            <div>
                                <div class="text-xl font-bold text-gray-900">Atlas Fulfillment</div>
                                <div class="text-xs text-gray-500">Admin Panel</div>
                            </div>
                        </div>
                    </a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Language Switcher -->
                    <div class="relative">
                        <form action="{% url 'set_language' %}" method="post" class="inline-block">
                            {% csrf_token %}
                            <input name="next" type="hidden" value="{{ request.path }}"/>
                            <select name="language" onchange="this.form.submit()" class="bg-white border border-gray-300 text-gray-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 transition-colors duration-200">
                                {% get_current_language as CURRENT_LANGUAGE %}
                                {% get_available_languages as LANGUAGES %}
                                {% for lang_code, lang_name in LANGUAGES %}
                                    <option value="{{ lang_code }}" {% if lang_code == CURRENT_LANGUAGE %}selected{% endif %}>
                                        {{ lang_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </form>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="relative">
                        <button id="notif-dropdown-button" class="p-2 rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-colors duration-200 relative">
                            <i class="fas fa-bell text-gray-600 text-lg"></i>
                            {% if unread_notifications_count > 0 %}
                            <span class="absolute -top-1 -right-1 flex h-4 w-4">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-4 w-4 bg-red-500 text-xs text-white items-center justify-center font-medium">{{ unread_notifications_count }}</span>
                            </span>
                            {% endif %}
                        </button>
                        <div id="notif-dropdown" class="hidden absolute mt-2 w-80 bg-white rounded-xl shadow-xl overflow-hidden z-20 top-14 right-0 border border-gray-200">
                            <div class="py-2">
                                <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                                    <h3 class="text-sm font-semibold text-gray-700">{% trans "Notifications" %}</h3>
                                    <a href="#" class="text-xs text-yellow-600 hover:text-yellow-700 font-medium">{% trans "Mark all as read" %}</a>
                                </div>
                                <div class="max-h-60 overflow-y-auto">
                                    {% if user_notifications %}
                                        {% for notification in user_notifications|slice:":5" %}
                                        <a href="{{ notification.get_absolute_url }}" class="block px-4 py-3 hover:bg-gray-50 {% if not notification.is_read %}bg-yellow-50{% endif %} transition-colors duration-200">
                                            <div class="flex items-start">
                                                <div class="flex-shrink-0 mr-3">
                                                    <div class="h-8 w-8 rounded-full bg-yellow-100 flex items-center justify-center">
                                                        <i class="fas fa-bell text-yellow-600 text-sm"></i>
                                                    </div>
                                                </div>
                                                <div class="flex-1 min-w-0">
                                                    <p class="text-sm font-medium text-gray-900 truncate">{{ notification.title }}</p>
                                                    <p class="text-xs text-gray-500 mt-1">{{ notification.message|truncatechars:60 }}</p>
                                                    <p class="text-xs text-gray-400 mt-1">{{ notification.created_at|timesince }} {% trans "ago" %}</p>
                                                </div>
                                            </div>
                                        </a>
                                        {% endfor %}
                                    {% else %}
                                        <div class="px-4 py-8 text-center text-gray-500">
                                            <i class="fas fa-bell-slash text-3xl mb-3 text-gray-300"></i>
                                            <p class="text-sm">{% trans "No notifications yet" %}</p>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="border-t border-gray-200 py-3 px-4 text-center bg-gray-50">
                                    <a href="#" class="text-xs text-yellow-600 hover:text-yellow-700 font-medium">{% trans "View all notifications" %}</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- User Menu -->
                    <div class="relative">
                        <button type="button" id="user-menu-button" class="flex items-center max-w-xs text-sm rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition-colors duration-200 hover:bg-gray-100 px-3 py-2" aria-expanded="false" aria-haspopup="true">
                            <span class="sr-only">{% trans "Open user menu" %}</span>
                            <div class="h-8 w-8 rounded-full bg-gradient-to-r from-yellow-500 to-yellow-600 flex items-center justify-center text-white shadow-lg">
                                {% if user.profile_image %}
                                    <img src="{{ user.profile_image.url }}" alt="{{ user.get_full_name }}" class="h-8 w-8 rounded-full object-cover">
                                {% else %}
                                    <span class="text-sm font-medium">{{ user.get_initials }}</span>
                                {% endif %}
                            </div>
                            <div class="ml-3 text-left">
                                <div class="text-sm font-medium text-gray-900">{{ user.get_short_name }}</div>
                                {% if user.get_primary_role %}
                                <div class="text-xs text-gray-500">{{ user.get_primary_role.name }}</div>
                                {% endif %}
                            </div>
                            <i class="fas fa-chevron-down ml-2 text-xs text-gray-500"></i>
                        </button>
                        
                        <div id="user-menu" class="hidden origin-top-right absolute right-0 mt-2 w-56 rounded-xl shadow-xl bg-white ring-1 ring-black ring-opacity-5 divide-y divide-gray-100 z-50 border border-gray-200" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
                            <div class="py-2" role="none">
                                <div class="block px-4 py-3 text-sm text-gray-700 border-b border-gray-100 bg-gray-50">
                                    <div class="font-medium text-gray-900">{{ user.get_full_name }}</div>
                                    <div class="text-xs text-gray-500">{{ user.email }}</div>
                                    {% if user.get_primary_role %}
                                    <div class="text-xs text-yellow-600 font-medium mt-1">{{ user.get_primary_role.name }}</div>
                                    {% endif %}
                                </div>
                                <a href="{% url 'users:profile' %}" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200" role="menuitem" tabindex="-1">
                                    <i class="fas fa-user mr-3 text-gray-400"></i> {% trans "Your Profile" %}
                                </a>
                                <a href="{% url 'dashboard:settings' %}" class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 transition-colors duration-200" role="menuitem" tabindex="-1">
                                    <i class="fas fa-cog mr-3 text-gray-400"></i> {% trans "Settings" %}
                                </a>
                                <div class="border-t border-gray-100"></div>
                                <a href="{% url 'users:logout' %}" class="block px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors duration-200" role="menuitem" tabindex="-1">
                                    <i class="fas fa-sign-out-alt mr-3"></i> {% trans "Sign out" %}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="flex min-h-screen page-container">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar text-white w-64 lg:w-64 fixed h-full z-10 left-0 shadow lg:block">
            <div class="overflow-y-auto h-full p-4">
                <!-- Role Display at Top -->
                <div class="mb-6 pb-4 border-b border-gray-600">
                    <div class="text-center">
                        <h2 class="text-xl font-bold text-yellow-400 mb-1">Atlas Fulfillment</h2>
                        {% if 'users:edit' in request.resolver_match.url_name or 'users:detail' in request.resolver_match.url_name %}
                            <p class="text-sm text-gray-300">Admin Panel</p>
                        {% elif user.get_primary_role %}
                        <p class="text-sm text-gray-300">{{ user.get_primary_role.name }}</p>
                        {% else %}
                        <p class="text-sm text-gray-300">User</p>
                        {% endif %}
                    </div>
                </div>
                
                <ul class="space-y-2">
                    <!-- Admin Panel for User Management -->
                    {% if 'users:edit' in request.resolver_match.url_name or 'users:detail' in request.resolver_match.url_name %}
                    <li>
                        <a href="{% url 'users:list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'users:list' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-users w-6"></i>
                            <span class="ml-3">{% trans "User Management" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'dashboard:index' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'dashboard:index' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span class="ml-3">{% trans "Admin Dashboard" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'users:create' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'users:create' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-user-plus w-6"></i>
                            <span class="ml-3">{% trans "Create User" %}</span>
                        </a>
                    </li>
                    
                    <!-- Call Center Agent Specific Sidebar -->
                    {% elif user.has_role_call_center_agent %}
                    <li>
                        <a href="{% url 'callcenter:agent_dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'agent_dashboard' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span class="ml-3">{% trans "Dashboard" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'callcenter:agent_order_list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'agent_order_list' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-shopping-cart w-6"></i>
                            <span class="ml-3">{% trans "Orders" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'callcenter:agent_reports' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'agent_reports' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-chart-bar w-6"></i>
                            <span class="ml-3">{% trans "Reports" %}</span>
                        </a>
                    </li>
                    
                    <!-- Call Center Manager Specific Sidebar -->
                    {% elif user.has_role_call_center_manager %}
                    <li>
                        <a href="{% url 'callcenter:manager_dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'manager_dashboard' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span class="ml-3">{% trans "Dashboard" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'callcenter:manager_order_list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'manager_order_list' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-shopping-cart w-6"></i>
                            <span class="ml-3">{% trans "Orders" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'callcenter:manager_agent_reports' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'manager_agent_reports' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-chart-bar w-6"></i>
                            <span class="ml-3">{% trans "Reports" %}</span>
                        </a>
                    </li>
                    
                    <!-- Accountant Sidebar -->
                    {% elif user.has_role_accountant %}
                    <li>
                        <a href="{% url 'finance:accountant_dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'accountant_dashboard' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span class="ml-3">{% trans "Dashboard" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'finance:order_management' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'order_management' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-calculator w-6"></i>
                            <span class="ml-3">{% trans "Order Management" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'finance:payment_processing' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'payment_processing' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-credit-card w-6"></i>
                            <span class="ml-3">{% trans "Payment Processing" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'finance:financial_reports' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'financial_reports' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-chart-line w-6"></i>
                            <span class="ml-3">{% trans "Financial Reports" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'finance:bank_reconciliation' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'bank_reconciliation' in request.resolver_match.url_name %}active{% endif %}">
                            <i class="fas fa-university w-6"></i>
                            <span class="ml-3">{% trans "Bank Reconciliation" %}</span>
                        </a>
                    </li>
                    
                    <!-- Default Sidebar for other roles -->
                    {% else %}
                    <li>
                        <a href="{% url 'dashboard:index' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span class="ml-3">{% trans "Dashboard" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'orders:list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'orders' in request.path %}active{% endif %}">
                            <i class="fas fa-shopping-cart w-6"></i>
                            <span class="ml-3">{% trans "Orders" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'inventory:dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'inventory' in request.path %}active{% endif %}">
                            <i class="fas fa-boxes w-6"></i>
                            <span class="ml-3">{% trans "Inventory" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'sourcing:dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'sourcing' in request.path %}active{% endif %}">
                            <i class="fas fa-globe w-6"></i>
                            <span class="ml-3">{% trans "Sourcing" %}</span>
                        </a>
                    </li>
                    
                    {% if user.has_role_call_center_manager or user.has_role_call_center_agent or user.has_role_admin or user.is_superuser %}
                    <li>
                        <a href="{% url 'callcenter:dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'callcenter' in request.path %}active{% endif %}">
                            <i class="fas fa-headset w-6"></i>
                            <span class="ml-3">
                                {% if user.has_role_call_center_manager %}
                                    {% trans "Call Center Manager" %}
                                {% elif user.has_role_call_center_agent %}
                                    {% trans "Call Center Agent" %}
                                {% else %}
                                    {% trans "Call Center" %}
                                {% endif %}
                            </span>
                        </a>
                    </li>
                    {% endif %}
                    
                    <li>
                        <a href="{% url 'packaging:dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'packaging' in request.path %}active{% endif %}">
                            <i class="fas fa-box w-6"></i>
                            <span class="ml-3">{% trans "Packaging" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'delivery:dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'delivery' in request.path %}active{% endif %}">
                            <i class="fas fa-truck w-6"></i>
                            <span class="ml-3">{% trans "Delivery" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'finance:accountant_dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'finance' in request.path %}active{% endif %}">
                            <i class="fas fa-money-bill-wave w-6"></i>
                            <span class="ml-3">{% trans "Finance" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'sellers:dashboard' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'sellers' in request.path %}active{% endif %}">
                            <i class="fas fa-users w-6"></i>
                            <span class="ml-3">{% trans "Sellers" %}</span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="{% url 'subscribers:list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'subscribers' in request.path %}active{% endif %}">
                            <i class="fas fa-user-friends w-6"></i>
                            <span class="ml-3">{% trans "Subscribers" %}</span>
                        </a>
                    </li>
                    
                    {% if user.can_create_roles %}
                    <li class="pt-4 mt-4 border-t border-gray-600">
                        <a href="{% url 'roles:role_list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'roles' in request.path %}active{% endif %}">
                            <i class="fas fa-user-tag w-6"></i>
                            <span class="ml-3">{% trans "Roles" %}</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'roles:permission_list' %}" class="menu-item flex items-center p-2 rounded hover:bg-gray-700 {% if 'permissions' in request.path %}active{% endif %}">
                            <i class="fas fa-shield-alt w-6"></i>
                            <span class="ml-3">{% trans "Permissions" %}</span>
                        </a>
                    </li>
                    {% endif %}
                    {% endif %}
                </ul>
                <!-- Beta Warning and Report Bug Button -->
                <div class="mt-8 p-4 rounded-lg bg-gradient-to-r from-yellow-400 to-orange-200  text-yellow-900 shadow-lg flex flex-col items-center mb-[6rem] ">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-exclamation-triangle text-xl mr-2"></i>
                        <span class="font-semibold text-sm">Beta Version</span>
                    </div>
                    <p class="text-xs text-yellow-900 text-center mb-3">This is a beta version and may have some bugs.</p>
                    <button type="button" onclick="openBugReportModal()" class="w-full bg-yellow-700 hover:bg-yellow-800 text-white px-4 py-2 rounded-lg text-xs font-medium flex items-center justify-center transition-colors duration-200">
                        <i class="fas fa-bug mr-2"></i> Report Bug
                    </button>
                </div>
                </div>
                                </div>
        
        <!-- Mobile menu backdrop -->
        <div id="sidebar-backdrop" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-40 hidden lg:hidden"></div>
        
        <!-- Main content -->
        <main class="main-content flex-1 bg-white lg:ml-64">
            <div class="py-6 content-wrapper">
                <div class="w-full">
                    <!-- Content -->
                        {% block content %}{% endblock %}
                </div>
            </div>
        </main>
    </div>

        <!-- Bug Report Modal -->
    <div id="bug-report-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-bug text-red-600"></i>
                            </div>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-lg font-semibold text-gray-900">Report a Bug</h3>
                            <p class="text-sm text-gray-600">Help us improve by reporting any issues you encounter</p>
                        </div>
                    </div>
                    <button type="button" onclick="closeBugReportModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>

                <!-- Modal Body -->
                <form id="bug-report-form" class="space-y-4">
                    {% csrf_token %}
                    
                    <!-- Title -->
                    <div>
                        <label for="bug-title" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag mr-2 text-primary-500"></i>
                            Bug Title *
                        </label>
                        <input type="text" id="bug-title" name="title" required
                               class="form-input w-full" 
                               placeholder="Brief description of the bug">
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="bug-description" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-align-left mr-2 text-primary-500"></i>
                            Description *
                        </label>
                        <textarea id="bug-description" name="description" rows="4" required
                                  class="form-input w-full resize-none" 
                                  placeholder="Detailed description of the bug, steps to reproduce, and expected behavior..."></textarea>
                    </div>

                    <!-- Priority -->
                    <div>
                        <label for="bug-priority" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-exclamation-triangle mr-2 text-primary-500"></i>
                            Priority
                        </label>
                        <select id="bug-priority" name="priority" class="form-input w-full">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>

                    <!-- Page URL -->
                    <div>
                        <label for="bug-page-url" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-link mr-2 text-primary-500"></i>
                            Page URL (where the bug occurred)
                        </label>
                        <input type="url" id="bug-page-url" name="page_url"
                               class="form-input w-full" 
                               placeholder="https://example.com/page-where-bug-occurs">
                    </div>

                    <!-- Screenshots -->
                    <div>
                        <label for="bug-images" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-image mr-2 text-primary-500"></i>
                            Screenshots (up to 5 images)
                        </label>
                        <div class="relative">
                            <input type="file" id="bug-images" name="images" multiple accept="image/*"
                                   class="hidden">
                            <label for="bug-images" class="cursor-pointer">
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-primary-400 transition-colors">
                                    <i class="fas fa-cloud-upload-alt text-2xl text-gray-400 mb-2"></i>
                                    <p class="text-sm text-gray-600">Click to upload or drag and drop</p>
                                    <p class="text-xs text-gray-500 mt-1">PNG, JPG, GIF up to 10MB each</p>
                                </div>
                            </label>
                        </div>
                        <div id="image-preview" class="mt-2 grid grid-cols-2 md:grid-cols-3 gap-2"></div>
                    </div>

                    <!-- Hidden fields for browser info -->
                    <input type="hidden" id="bug-browser-info" name="browser_info">
                </form>

                <!-- Modal Footer -->
                <div class="flex items-center justify-end space-x-3 mt-6 pt-4 border-t border-gray-200">
                    <button type="button" onclick="closeBugReportModal()" 
                            class="btn-secondary">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </button>
                    <button type="button" onclick="submitBugReport()" 
                            class="btn-primary" id="submit-bug-btn">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Submit Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Sidebar toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.getElementById('sidebar');
            const sidebarBackdrop = document.getElementById('sidebar-backdrop');
            
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('hidden');
                    sidebarBackdrop.classList.toggle('hidden');
                });
            }
            
            if (sidebarBackdrop) {
                sidebarBackdrop.addEventListener('click', function() {
                    sidebar.classList.add('hidden');
                    sidebarBackdrop.classList.add('hidden');
                });
            }
            
            // Notification dropdown toggle
            const notificationButton = document.getElementById('notif-dropdown-button');
            const notificationDropdown = document.getElementById('notif-dropdown');
            
            if (notificationButton && notificationDropdown) {
                notificationButton.addEventListener('click', function() {
                    notificationDropdown.classList.toggle('hidden');
                });
            }
            
            // Profile dropdown toggle
            const profileButton = document.getElementById('user-menu-button');
            const profileDropdown = document.getElementById('user-menu');
            
            if (profileButton && profileDropdown) {
                profileButton.addEventListener('click', function() {
                    profileDropdown.classList.toggle('hidden');
                });
            }
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                if (notificationButton && notificationDropdown && !notificationButton.contains(event.target) && !notificationDropdown.contains(event.target)) {
                    notificationDropdown.classList.add('hidden');
                }
                
                if (profileButton && profileDropdown && !profileButton.contains(event.target) && !profileDropdown.contains(event.target)) {
                    profileDropdown.classList.add('hidden');
                }
            });

            // Set browser info
            const browserInfo = `${navigator.userAgent} - ${navigator.platform}`;
            document.getElementById('bug-browser-info').value = browserInfo;
        });

        // Bug Report Modal Functions
        function openBugReportModal() {
            document.getElementById('bug-report-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeBugReportModal() {
            document.getElementById('bug-report-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            // Reset form
            document.getElementById('bug-report-form').reset();
            document.getElementById('image-preview').innerHTML = '';
        }

        function dismissBetaWarning() {
            const warning = document.querySelector('.bg-gradient-to-r.from-yellow-400.to-orange-500');
            if (warning) {
                warning.style.display = 'none';
            }
        }

        // Image preview functionality
        document.addEventListener('DOMContentLoaded', function() {
            const imageInput = document.getElementById('bug-images');
            const imagePreview = document.getElementById('image-preview');

            imageInput.addEventListener('change', function(e) {
                imagePreview.innerHTML = '';
                const files = Array.from(e.target.files);
                
                files.forEach((file, index) => {
                    if (index >= 5) return; // Max 5 images
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.createElement('div');
                        preview.className = 'relative';
                        preview.innerHTML = `
                            <img src="${e.target.result}" alt="Preview" class="w-full h-20 object-cover rounded border">
                            <button type="button" onclick="removeImage(${index})" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        imagePreview.appendChild(preview);
                    };
                    reader.readAsDataURL(file);
                });
            });
        });

        function removeImage(index) {
            const imageInput = document.getElementById('bug-images');
            const dt = new DataTransfer();
            const files = Array.from(imageInput.files);
            
            files.forEach((file, i) => {
                if (i !== index) {
                    dt.items.add(file);
                }
            });
            
            imageInput.files = dt.files;
            imageInput.dispatchEvent(new Event('change'));
        }

        function submitBugReport() {
            const form = document.getElementById('bug-report-form');
            const submitBtn = document.getElementById('submit-bug-btn');
            const formData = new FormData(form);

            // Show loading state
            submitBtn.innerHTML = '<div class="loading mr-2"></div>Submitting...';
            submitBtn.disabled = true;

            // Submit via AJAX
            fetch('{% url "bug_reports:ajax_report_bug" %}', {
                method: 'POST',
                body: formData,
                // Don't set Content-Type header for FormData - browser will set it automatically with boundary
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    alert(data.message);
                    closeBugReportModal();
                    // Optionally refresh the page or show a success notification
                } else {
                    // Show error message
                    alert('Error: ' + (data.message || 'Failed to submit bug report'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error submitting bug report. Please try again.');
            })
            .finally(() => {
                // Reset button
                submitBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>Submit Report';
                submitBtn.disabled = false;
            });
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html> 