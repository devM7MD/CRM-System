{% extends 'warehouse_inventory/base.html' %}
{% load i18n %}
{% load static %}

{% block page_title %}{% trans "Add Products to" %} {{ warehouse.name }}{% endblock %}

{% block inventory_content %}
<div class="max-w-4xl mx-auto">
    <form method="post" class="space-y-8">
        {% csrf_token %}
        
        <!-- Order Selection -->
        <div>
            <h3 class="text-lg font-medium text-gray-900 mb-4">{% trans "Select Orders to Add" %}</h3>
            
            <!-- Filters -->
            <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="seller" class="block text-sm font-medium text-gray-700">{% trans "Seller" %}</label>
                    <select id="seller" name="seller" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="">{% trans "All Sellers" %}</option>
                        {% for seller in sellers %}
                        <option value="{{ seller.id }}">{{ seller.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label for="date_range" class="block text-sm font-medium text-gray-700">{% trans "Date Range" %}</label>
                    <select id="date_range" name="date_range" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="today">{% trans "Today" %}</option>
                        <option value="yesterday">{% trans "Yesterday" %}</option>
                        <option value="last_7_days">{% trans "Last 7 Days" %}</option>
                        <option value="last_30_days">{% trans "Last 30 Days" %}</option>
                        <option value="custom">{% trans "Custom Range" %}</option>
                    </select>
                </div>
                
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700">{% trans "Status" %}</label>
                    <select id="status" name="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                        <option value="pending">{% trans "Pending" %}</option>
                        <option value="processing">{% trans "Processing" %}</option>
                        <option value="all">{% trans "All" %}</option>
                    </select>
                </div>
            </div>
            
            <!-- Search -->
            <div class="mb-6">
                <div class="mt-1 relative rounded-md shadow-sm">
                    <input type="text" name="search" id="search" 
                           class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-4 pr-12 sm:text-sm border-gray-300 rounded-md" 
                           placeholder="{% trans 'Search orders...' %}">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                </div>
            </div>
            
            <!-- Orders List -->
            <div class="bg-white shadow overflow-hidden border border-gray-200 sm:rounded-lg">
                <div class="px-4 py-5 sm:px-6 bg-gray-50 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">{% trans "Available Orders" %}</h3>
                        <div class="flex items-center">
                            <input type="checkbox" id="select_all" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="select_all" class="ml-2 block text-sm text-gray-900">
                                {% trans "Select All" %}
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="divide-y divide-gray-200">
                    {% for order in orders %}
                    <div class="px-4 py-4 sm:px-6 hover:bg-gray-50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input type="checkbox" name="order_ids" value="{{ order.id }}" 
                                       class="order-checkbox h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">
                                        {% trans "Order" %} #{{ order.id }}
                                    </div>
                                    <div class="text-sm text-gray-500">
                                        {{ order.seller.name }}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <div class="text-sm text-gray-500 mr-4">
                                    {{ order.items.count }} {% trans "items" %}
                                </div>
                                <div class="text-sm text-gray-500">
                                    {{ order.date|date:"Y-m-d H:i" }}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Items -->
                        <div class="mt-4 ml-8 text-sm text-gray-500">
                            {% for item in order.items.all %}
                            <div class="flex items-center justify-between py-1">
                                <div>{{ item.product.name_en }}</div>
                                <div>{{ item.quantity }} {% trans "units" %}</div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% empty %}
                    <div class="px-4 py-5 text-center text-gray-500">
                        {% trans "No orders available." %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Notes -->
        <div>
            <label for="notes" class="block text-sm font-medium text-gray-700">{% trans "Notes" %}</label>
            <div class="mt-1">
                <textarea id="notes" name="notes" rows="3" 
                          class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border border-gray-300 rounded-md"
                          placeholder="{% trans 'Add any notes about this inventory addition...' %}"></textarea>
            </div>
        </div>
        
        <!-- Submit -->
        <div class="flex justify-end space-x-3">
            <a href="{% url 'warehouse_inventory:warehouse_inventory' warehouse.id %}" 
               class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                {% trans "Cancel" %}
            </a>
            <button type="submit" 
                    class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                {% trans "Add to Stock" %}
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAllCheckbox = document.getElementById('select_all');
    const orderCheckboxes = document.querySelectorAll('.order-checkbox');
    
    // Select all functionality
    selectAllCheckbox.addEventListener('change', function() {
        orderCheckboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
    
    // Update select all when individual checkboxes change
    orderCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const allChecked = Array.from(orderCheckboxes).every(cb => cb.checked);
            const noneChecked = Array.from(orderCheckboxes).every(cb => !cb.checked);
            
            selectAllCheckbox.checked = allChecked;
            selectAllCheckbox.indeterminate = !allChecked && !noneChecked;
        });
    });
    
    // Filter functionality
    const searchInput = document.getElementById('search');
    const orderItems = document.querySelectorAll('.order-item');
    
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        
        orderItems.forEach(item => {
            const orderText = item.textContent.toLowerCase();
            item.style.display = orderText.includes(searchTerm) ? 'block' : 'none';
        });
    });
});
</script>
{% endblock %} 