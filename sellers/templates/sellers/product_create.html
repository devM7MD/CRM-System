{% extends 'base.html' %}
{% load static %}

{% block title %}Create New Product{% endblock %}

{% block content %}
<div class="bg-white dark:bg-gray-900">
    <!-- Page Header -->
    <div class="bg-yellow-400 dark:bg-yellow-600 shadow-lg">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Create New Product</h1>
        </div>
    </div>

    <!-- Product Form -->
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <div class="bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="px-4 py-5 sm:p-6">
                    <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                        <!-- Basic Information -->
                        <div class="sm:col-span-6">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Basic Information</h3>
                        </div>

                        <!-- Product Name -->
                        <div class="sm:col-span-3">
                            <label for="name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Product Name (English)</label>
                            <div class="mt-1">
                                <input type="text" name="name" id="name" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                        </div>

                        <!-- Product Name (Arabic) -->
                        <div class="sm:col-span-3">
                            <label for="name_ar" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Product Name (Arabic)</label>
                            <div class="mt-1">
                                <input type="text" name="name_ar" id="name_ar" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>

                        <!-- SKU -->
                        <div class="sm:col-span-2">
                            <label for="code" class="block text-sm font-medium text-gray-700 dark:text-gray-300">SKU/Product Code</label>
                            <div class="mt-1">
                                <input type="text" name="code" id="code" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                        </div>

                        <!-- Category -->
                        <div class="sm:col-span-2">
                            <label for="category" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Category</label>
                            <div class="mt-1">
                                <select id="category" name="category" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                                    <option value="">Select a category</option>
                                    {% for category in categories %}
                                    <option value="{{ category.id }}">{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Brand -->
                        <div class="sm:col-span-2">
                            <label for="brand" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Brand</label>
                            <div class="mt-1">
                                <select id="brand" name="brand" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md">
                                    <option value="">Select a brand</option>
                                    {% for brand in brands %}
                                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="sm:col-span-6">
                            <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Description (English)</label>
                            <div class="mt-1">
                                <textarea id="description" name="description" rows="3" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">Brief description of the product.</p>
                        </div>

                        <!-- Description (Arabic) -->
                        <div class="sm:col-span-6">
                            <label for="description_ar" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Description (Arabic)</label>
                            <div class="mt-1">
                                <textarea id="description_ar" name="description_ar" rows="3" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                            </div>
                        </div>

                        <!-- Pricing -->
                        <div class="sm:col-span-6">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Pricing Information</h3>
                        </div>

                        <!-- Cost Price -->
                        <div class="sm:col-span-2">
                            <label for="cost_price" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Cost Price (AED)</label>
                            <div class="mt-1">
                                <input type="number" name="cost_price" id="cost_price" min="0" step="0.01" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                        </div>

                        <!-- Selling Price -->
                        <div class="sm:col-span-2">
                            <label for="selling_price" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Selling Price (AED)</label>
                            <div class="mt-1">
                                <input type="number" name="selling_price" id="selling_price" min="0" step="0.01" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                        </div>

                        <!-- Discount -->
                        <div class="sm:col-span-2">
                            <label for="discount" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Discount (%)</label>
                            <div class="mt-1">
                                <input type="number" name="discount" id="discount" min="0" max="100" step="0.1" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>

                        <!-- Inventory -->
                        <div class="sm:col-span-6">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Inventory Information</h3>
                        </div>

                        <!-- Total Quantity -->
                        <div class="sm:col-span-2">
                            <label for="total_quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Total Quantity</label>
                            <div class="mt-1">
                                <input type="number" name="total_quantity" id="total_quantity" min="0" step="1" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                        </div>

                        <!-- Available Quantity -->
                        <div class="sm:col-span-2">
                            <label for="available_quantity" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Available Quantity</label>
                            <div class="mt-1">
                                <input type="number" name="available_quantity" id="available_quantity" min="0" step="1" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                            </div>
                        </div>

                        <!-- Low Stock Threshold -->
                        <div class="sm:col-span-2">
                            <label for="low_stock_threshold" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Low Stock Threshold</label>
                            <div class="mt-1">
                                <input type="number" name="low_stock_threshold" id="low_stock_threshold" min="0" step="1" class="shadow-sm focus:ring-yellow-500 focus:border-yellow-500 block w-full sm:text-sm border-gray-300 rounded-md">
                            </div>
                        </div>

                        <!-- Images -->
                        <div class="sm:col-span-6">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Product Images</h3>
                        </div>

                        <!-- Main Image -->
                        <div class="sm:col-span-6">
                            <label for="image" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Main Product Image</label>
                            <div class="mt-1">
                                <input type="file" name="image" id="image" class="sr-only">
                                <label for="image" class="cursor-pointer block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium leading-4 text-gray-700 bg-white hover:bg-gray-50 focus:outline-none">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <span class="ml-2">Choose file</span>
                                    </div>
                                </label>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">PNG, JPG, GIF up to 5MB</p>
                        </div>

                        <!-- Additional Images -->
                        <div class="sm:col-span-6">
                            <label for="additional_images" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Additional Images</label>
                            <div class="mt-1">
                                <input type="file" name="additional_images" id="additional_images" multiple class="sr-only">
                                <label for="additional_images" class="cursor-pointer block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium leading-4 text-gray-700 bg-white hover:bg-gray-50 focus:outline-none">
                                    <div class="flex items-center">
                                        <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                        </svg>
                                        <span class="ml-2">Choose multiple files</span>
                                    </div>
                                </label>
                            </div>
                            <p class="mt-2 text-sm text-gray-500">You can select multiple images</p>
                        </div>

                        <!-- Sales Channels -->
                        <div class="sm:col-span-6">
                            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Sales Channels</h3>
                            <p class="mt-1 text-sm text-gray-500">Select which channels this product will be available on.</p>
                        </div>

                        <!-- Sales Channels Checkboxes -->
                        <div class="sm:col-span-6">
                            <fieldset>
                                <div class="mt-4 space-y-4">
                                    {% for channel in sales_channels %}
                                    <div class="flex items-start">
                                        <div class="flex items-center h-5">
                                            <input id="channel_{{ channel.id }}" name="sales_channels" value="{{ channel.id }}" type="checkbox" class="focus:ring-yellow-500 h-4 w-4 text-yellow-600 border-gray-300 rounded">
                                        </div>
                                        <div class="ml-3 text-sm">
                                            <label for="channel_{{ channel.id }}" class="font-medium text-gray-700 dark:text-gray-300">{{ channel.name }}</label>
                                            <p class="text-gray-500">{{ channel.description }}</p>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 text-right sm:px-6">
                    <button type="button" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 mr-3">
                        Cancel
                    </button>
                    <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                        Create Product
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Set the available quantity to match total quantity by default
    document.getElementById('total_quantity').addEventListener('input', function() {
        document.getElementById('available_quantity').value = this.value;
    });

    // Calculate selling price based on cost price and markup
    document.getElementById('cost_price').addEventListener('input', function() {
        const costPrice = parseFloat(this.value) || 0;
        const markup = 0.3; // 30% markup by default
        const sellingPrice = costPrice * (1 + markup);
        document.getElementById('selling_price').value = sellingPrice.toFixed(2);
    });
</script>
{% endblock %} 