{% extends "admin_base.html" %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Finance Dashboard" %}{% endblock %}

{% block content %}
<div class="mb-6 flex justify-between items-center">
    <h2 class="text-2xl font-semibold text-gray-800">{% trans "Finance Dashboard" %}</h2>
    <div class="flex space-x-3">
        <a href="{% url 'finance:add_payment' %}" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition-colors">
            <i class="fas fa-plus mr-2"></i>{% trans "Add Payment" %}
        </a>
        <a href="{% url 'finance:finance_list' %}" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
            <i class="fas fa-list mr-2"></i>{% trans "Finance Records" %}
        </a>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
    <!-- Revenue -->
    <div class="stat-card">
        <div class="p-5">
            <div class="flex items-center">
                <div class="bg-yellow-500 p-3 rounded-md">
                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-500">{% trans "Total Revenue" %}</p>
                    <p class="text-xl font-semibold text-gray-900">{{ total_revenue|default:"0" }} {% trans "this month" %}</p>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex justify-between text-sm">
                    <span class="text-green-600">{% trans "YTD" %}: {{ ytd_revenue|default:"0" }}</span>
                    <a href="{% url 'finance:financial_reports' %}?type=revenue" class="text-yellow-600 hover:text-yellow-700 font-medium inline-flex items-center">
                        {% trans "Details" %}
                        <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Expenses -->
    <div class="stat-card">
        <div class="p-5">
            <div class="flex items-center">
                <div class="bg-yellow-500 p-3 rounded-md">
                    <i class="fas fa-chart-pie text-white text-xl"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-500">{% trans "Total Expenses" %}</p>
                    <p class="text-xl font-semibold text-gray-900">{{ total_expenses|default:"0" }} {% trans "this month" %}</p>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex justify-between text-sm">
                    <span class="text-red-600">{% trans "YTD" %}: {{ ytd_expenses|default:"0" }}</span>
                    <a href="{% url 'finance:financial_reports' %}?type=expenses" class="text-yellow-600 hover:text-yellow-700 font-medium inline-flex items-center">
                        {% trans "Details" %}
                        <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profit -->
    <div class="stat-card">
        <div class="p-5">
            <div class="flex items-center">
                <div class="bg-yellow-500 p-3 rounded-md">
                    <i class="fas fa-chart-line text-white text-xl"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-500">{% trans "Net Profit" %}</p>
                    <p class="text-xl font-semibold text-gray-900">{{ net_profit|default:"0" }} {% trans "this month" %}</p>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex justify-between text-sm">
                    <span class="{% if ytd_profit > 0 %}text-green-600{% else %}text-red-600{% endif %}">{% trans "YTD" %}: {{ ytd_profit|default:"0" }}</span>
                    <a href="{% url 'finance:financial_reports' %}?type=profit" class="text-yellow-600 hover:text-yellow-700 font-medium inline-flex items-center">
                        {% trans "Details" %}
                        <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Outstanding -->
    <div class="stat-card">
        <div class="p-5">
            <div class="flex items-center">
                <div class="bg-yellow-500 p-3 rounded-md">
                    <i class="fas fa-exclamation-circle text-white text-xl"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-500">{% trans "Outstanding Payments" %}</p>
                    <p class="text-xl font-semibold text-gray-900">{{ outstanding_payments|default:"0" }}</p>
                </div>
            </div>
            <div class="mt-4">
                <a href="{% url 'finance:pending_payments' %}" class="text-yellow-600 hover:text-yellow-700 font-medium inline-flex items-center">
                    {% trans "View all" %}
                    <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 gap-6 lg:grid-cols-2 mb-8">
    <!-- Revenue Chart -->
    <div class="card p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{% trans "Revenue Overview" %}</h3>
        <div class="h-64">
            <canvas id="revenueChart"></canvas>
        </div>
    </div>
    
    <!-- Expense Breakdown -->
    <div class="card p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">{% trans "Expense Breakdown" %}</h3>
        <div class="h-64">
            <canvas id="expenseChart"></canvas>
        </div>
    </div>
</div>

<!-- Recent Transactions -->
<div class="card">
    <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-lg font-medium text-gray-900">{% trans "Recent Transactions" %}</h3>
        <a href="{% url 'finance:finance_list' %}" class="text-yellow-600 hover:text-yellow-700 font-medium">
            {% trans "View All" %} â†’
        </a>
    </div>
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {% trans "Order ID" %}
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {% trans "Transaction Type" %}
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {% trans "Amount" %}
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {% trans "Date" %}
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {% trans "Status" %}
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        {% trans "Actions" %}
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for transaction in recent_transactions %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ transaction.order_id }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">{{ transaction.get_transaction_type_display }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm {% if transaction.transaction_type == 'payment' %}text-green-600{% else %}text-red-600{% endif %}">
                            {% if transaction.transaction_type == 'payment' %}+{% else %}-{% endif %}{{ transaction.amount }}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">{{ transaction.created_at|date:"M d, Y" }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if transaction.status == 'completed' %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                            {% trans "Completed" %}
                        </span>
                        {% elif transaction.status == 'pending' %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                            {% trans "Pending" %}
                        </span>
                        {% else %}
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                            {% trans "Failed" %}
                        </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <a href="{% url 'finance:transaction_detail' transaction.id %}" class="text-yellow-600 hover:text-yellow-900 mr-2">
                            <i class="fas fa-eye"></i>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">
                        {% trans "No recent transactions." %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Revenue Chart
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        const revenueChart = new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                datasets: [{
                    label: '{% trans "Revenue" %}',
                    data: [12000, 19000, 30000, 50000, 20000, 30000, 70000, 85000, 60000, 55000, 40000, 80000],
                    backgroundColor: 'rgba(245, 158, 11, 0.2)',
                    borderColor: 'rgba(245, 158, 11, 1)',
                    borderWidth: 2,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Expense Chart
        const expenseCtx = document.getElementById('expenseChart').getContext('2d');
        const expenseChart = new Chart(expenseCtx, {
            type: 'doughnut',
            data: {
                labels: ['{% trans "Operational" %}', '{% trans "Marketing" %}', '{% trans "Payroll" %}', '{% trans "Inventory" %}', '{% trans "Other" %}'],
                datasets: [{
                    data: [25, 20, 30, 15, 10],
                    backgroundColor: [
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(239, 68, 68, 0.8)',
                        'rgba(107, 114, 128, 0.8)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    });
</script>
{% endblock %} 